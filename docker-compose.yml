services:
  # This is your Python Backend
  backend:
    build:
      context: ./backend  # Tells it to use the 'backend/Dockerfile'
    ports:
      - "8000:8000"     # Maps your computer's port 8000 to the container's
    volumes:
      - ./backend:/app  # Syncs your local code for easy development
    healthcheck:
      # This command repeatedly checks if the backend is responding
      test: ["CMD", "curl", "-f", "http://localhost:8000/"]
      interval: 10s       # Check every 10 seconds
      timeout: 5s         # Give up after 5 seconds
      retries: 5          # Try 5 times
      start_period: 30s   # Gives models 30s to load BEFORE starting checks

  # This is your Next.js Frontend
  frontend:
    build:
      context: .        # Tells it to use the root 'Dockerfile'
    ports:
      - "3000:3000"     # Maps your computer's port 3000 to the container's
    environment:
      # Tells the frontend to find the backend at the service name 'backend'
      NEXT_PUBLIC_API_URL: http://backend:8000/predict
    depends_on:
      backend:
        condition: service_healthy # Waits for the backend to be ready